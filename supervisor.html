<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>CompliSense AI - Supervisor Dashboard</title>

  <link rel="stylesheet" href="styles/aia-theme.css">
  <link rel="stylesheet" href="styles/components.css">
  <style>
    .dashboard-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: var(--space-xl);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
    }

    .stat-card {
      background: white;
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border-left: 4px solid var(--gray-300);
    }

    .stat-card.high-risk {
      border-left-color: #EF4444;
    }

    .stat-card.medium-risk {
      border-left-color: #F59E0B;
    }

    .stat-card.low-risk {
      border-left-color: #10B981;
    }

    .stat-card.pending {
      border-left-color: #3B82F6;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
    }

    .filter-bar {
      background: white;
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      margin-bottom: var(--space-xl);
      display: flex;
      gap: var(--space-md);
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .proposal-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .proposal-card {
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: var(--space-lg);
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: var(--space-lg);
      align-items: center;
      transition: all 0.2s ease;
      border-left: 4px solid transparent;
    }

    .proposal-card:hover {
      box-shadow: var(--shadow-md);
    }

    .proposal-card.high-risk {
      border-left-color: #EF4444;
      background: #FEF2F2;
    }

    .proposal-card.medium-risk {
      border-left-color: #F59E0B;
      background: #FFFBEB;
    }

    .proposal-card.low-risk {
      border-left-color: #10B981;
      background: #F0FDF4;
    }

    .risk-indicator {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      flex-shrink: 0;
    }

    .risk-indicator.high {
      background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
      color: white;
    }

    .risk-indicator.medium {
      background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
      color: white;
    }

    .risk-indicator.low {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
    }

    .proposal-info {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: var(--space-lg);
      flex: 1;
    }

    .info-block h4 {
      font-size: var(--font-size-xs);
      color: var(--gray-600);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .info-block p {
      font-size: var(--font-size-base);
      color: var(--gray-900);
      font-weight: 600;
      margin: 0;
    }

    .info-block .small-text {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
      font-weight: 400;
      margin-top: 2px;
    }

    .proposal-actions {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .ai-recommendation {
      background: var(--info-bg);
      border: 1px solid var(--info-border);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      margin-top: var(--space-sm);
      font-size: var(--font-size-sm);
    }

    .ai-recommendation strong {
      color: var(--info-text);
    }

    .issues-list {
      list-style: none;
      margin-top: var(--space-sm);
      padding: 0;
    }

    .issues-list li {
      font-size: var(--font-size-sm);
      color: var(--gray-700);
      padding: 4px 0;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .bulk-actions {
      position: sticky;
      bottom: 20px;
      background: white;
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--space-xl);
    }

    .section-divider {
      margin: var(--space-2xl) 0;
      text-align: center;
      position: relative;
    }

    .section-divider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--gray-200);
    }

    .section-divider span {
      background: var(--bg-page);
      padding: 0 var(--space-lg);
      position: relative;
      font-weight: 600;
      color: var(--gray-600);
    }

    /* Review Modal Styles */
    .review-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      padding: var(--space-lg);
      overflow-y: auto;
    }

    .review-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .review-modal-content {
      background: white;
      border-radius: var(--radius-lg);
      max-width: 1000px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .review-modal-header {
      padding: var(--space-xl);
      border-bottom: 2px solid var(--gray-200);
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
    }

    .review-modal-body {
      padding: var(--space-xl);
    }

    .review-modal-footer {
      padding: var(--space-xl);
      border-top: 2px solid var(--gray-200);
      background: var(--gray-50);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      bottom: 0;
      z-index: 10;
    }

    .fhr-section {
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin-bottom: var(--space-lg);
    }

    .fhr-section h3 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: var(--space-md);
      color: var(--gray-900);
    }

    .fhr-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-md);
    }

    .fhr-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .fhr-label {
      font-size: var(--font-size-xs);
      color: var(--gray-600);
      font-weight: 600;
    }

    .fhr-value {
      font-size: var(--font-size-sm);
      color: var(--gray-900);
      font-weight: 600;
    }

    .compliance-check-item {
      background: white;
      border-left: 3px solid transparent;
      padding: var(--space-md);
      border-radius: var(--radius-sm);
      margin-bottom: var(--space-sm);
    }

    .compliance-check-item.pass {
      border-left-color: #10B981;
      background: #F0FDF4;
    }

    .compliance-check-item.fail {
      border-left-color: #EF4444;
      background: #FEF2F2;
    }

    .compliance-check-item.warning {
      border-left-color: #F59E0B;
      background: #FFFBEB;
    }

    .check-title {
      font-weight: 600;
      font-size: var(--font-size-sm);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .check-explanation {
      font-size: var(--font-size-xs);
      color: var(--gray-600);
      line-height: 1.6;
    }

    .close-modal-btn {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: var(--gray-500);
      padding: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .close-modal-btn:hover {
      background: var(--gray-100);
      color: var(--gray-900);
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <a href="index.html" class="navbar-brand">
      <span style="font-size: 28px;">🧠</span>
      <span>CompliSense AI</span>
    </a>
    <ul class="navbar-menu">
      <li><a href="index.html">FHR Form</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="portfolio.html">Portfolio</a></li>
      <li class="nav-dropdown">
        <span class="nav-dropdown-toggle">AI Tools ▾</span>
        <div class="nav-dropdown-menu">
          <a href="copilot.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">💬</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">AI Copilot</div>
              <div class="nav-dropdown-item-desc">Chat compliance assistant</div>
            </div>
          </a>
          <a href="analytics.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">📈</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Performance Analytics</div>
              <div class="nav-dropdown-item-desc">Track metrics & anomalies</div>
            </div>
          </a>
          <a href="graph.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">🕸️</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Compliance Graph</div>
              <div class="nav-dropdown-item-desc">Visualize relationships</div>
            </div>
          </a>
          <a href="documents.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">📄</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Document Intelligence</div>
              <div class="nav-dropdown-item-desc">OCR & extraction</div>
            </div>
          </a>
          <a href="regulatory.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">🔔</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Regulatory Updates</div>
              <div class="nav-dropdown-item-desc">Latest MAS notices</div>
            </div>
          </a>
        </div>
      </li>
      <li><a href="supervisor.html" class="active">Supervisor</a></li>
    </ul>
    <div class="navbar-actions">
      <span class="text-gray">Supervisor: <strong>Sarah Chen</strong></span>
      <span class="badge badge-success">Manager</span>
    </div>
  </nav>

  <!-- Dashboard Container -->
  <div class="dashboard-container">
    <!-- Alert -->
    <div class="alert alert-warning" style="margin-bottom: var(--space-xl);">
      <span class="alert-icon">⚠️</span>
      <div class="alert-content">
        <div class="alert-title">3 High-Risk Proposals Require Immediate Attention</div>
        <div>CompliSense AI has identified proposals with significant compliance issues. Review high-risk items first to prevent regulatory violations.</div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card pending">
        <div class="stat-value">50</div>
        <div class="stat-label">Total Pending Review</div>
      </div>
      <div class="stat-card high-risk">
        <div class="stat-value">3</div>
        <div class="stat-label">High Risk (Urgent)</div>
      </div>
      <div class="stat-card medium-risk">
        <div class="stat-value">12</div>
        <div class="stat-label">Medium Risk</div>
      </div>
      <div class="stat-card low-risk">
        <div class="stat-value">35</div>
        <div class="stat-label">Low Risk (Auto-Approve)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">15 min</div>
        <div class="stat-label">Avg Review Time</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">92%</div>
        <div class="stat-label">Approval Rate (7 Days)</div>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <div class="filter-group">
        <label class="text-sm text-bold">Risk Level:</label>
        <select class="form-select" style="width: 150px;">
          <option>All Levels</option>
          <option selected>High Risk</option>
          <option>Medium Risk</option>
          <option>Low Risk</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="text-sm text-bold">Agent:</label>
        <select class="form-select" style="width: 200px;">
          <option>All Agents</option>
          <option>Mahadevan Kartik</option>
          <option>John Tan</option>
          <option>Mary Lim</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="text-sm text-bold">Date:</label>
        <select class="form-select" style="width: 150px;">
          <option>Today</option>
          <option>Last 7 Days</option>
          <option>Last 30 Days</option>
        </select>
      </div>
      <div style="flex: 1;"></div>
      <button class="btn btn-ghost">Export Report</button>
      <button class="btn btn-primary">Bulk Approve (35 Low Risk)</button>
    </div>

    <!-- Section Header -->
    <div class="section-header">
      <h2 class="section-title">🚨 High Risk Proposals (3)</h2>
      <span class="badge badge-error">Immediate Action Required</span>
    </div>

    <!-- High Risk Proposals -->
    <div class="proposal-list">
      <!-- Proposal 1 -->
      <div class="proposal-card high-risk">
        <div class="risk-indicator high">
          <span>⚠️</span>
        </div>

        <div class="proposal-info">
          <div class="info-block">
            <h4>Client & Agent</h4>
            <p>Tan Wei Ming (35)</p>
            <div class="small-text">Agent: Mahadevan Kartik</div>
          </div>
          <div class="info-block">
            <h4>Product</h4>
            <p>Term Life</p>
            <div class="small-text">$800/month premium</div>
          </div>
          <div class="info-block">
            <h4>Compliance Score</h4>
            <p style="color: #EF4444;">67/100</p>
            <div class="small-text">3 major issues</div>
          </div>
          <div class="info-block">
            <h4>Submitted</h4>
            <p>2 hours ago</p>
            <div class="small-text">15-Dec-2025</div>
          </div>
        </div>

        <div class="proposal-actions">
          <button class="btn btn-primary" onclick="reviewProposal(1)">Review Details</button>
          <button class="btn btn-ghost">Request Revision</button>
        </div>

        <div style="grid-column: 1 / -1;">
          <div class="ai-recommendation">
            <strong>🤖 AI Recommendation: REJECT</strong> (78% confidence)
            <ul class="issues-list">
              <li>❌ Premium $800/month = 17.8% of income (exceeds 15% MoneySense limit by $125)</li>
              <li>❌ Emergency fund $8,000 = 2.5 months (below 3-month minimum requirement)</li>
              <li>⚠️ CI coverage $150,000 = 2.8x income (below 4x MoneySense guideline)</li>
            </ul>
            <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--info-border);">
              <strong>Suggested Action:</strong> Return to agent with feedback: "Reduce premium to $675/month or client must build emergency fund to minimum $9,600 before proceeding."
            </div>
          </div>
        </div>
      </div>

      <!-- Proposal 2 -->
      <div class="proposal-card high-risk">
        <div class="risk-indicator high">
          <span>⚠️</span>
        </div>

        <div class="proposal-info">
          <div class="info-block">
            <h4>Client & Agent</h4>
            <p>Lim Siew Hong (68)</p>
            <div class="small-text">Agent: John Tan</div>
          </div>
          <div class="info-block">
            <h4>Product</h4>
            <p>Investment-Linked</p>
            <div class="small-text">$600/month premium</div>
          </div>
          <div class="info-block">
            <h4>Compliance Score</h4>
            <p style="color: #EF4444;">52/100</p>
            <div class="small-text">2 critical issues</div>
          </div>
          <div class="info-block">
            <h4>Submitted</h4>
            <p>4 hours ago</p>
            <div class="small-text">15-Dec-2025</div>
          </div>
        </div>

        <div class="proposal-actions">
          <button class="btn btn-primary" onclick="reviewProposal(2)">Review Details</button>
          <button class="btn btn-ghost">Request Revision</button>
        </div>

        <div style="grid-column: 1 / -1;">
          <div class="ai-recommendation">
            <strong>🤖 AI Recommendation: REJECT</strong> (92% confidence)
            <ul class="issues-list">
              <li>❌ ILP not suitable for client age 68 (MoneySense: no high-risk products for 65+)</li>
              <li>❌ Premium $7,200/year = 24% of retirement savings depletion risk</li>
              <li>⚠️ Missing explicit risk disclosure acknowledgment in justification</li>
            </ul>
            <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--info-border);">
              <strong>Suggested Action:</strong> Reject immediately. Recommend RetireSecure Plus or MediShield supplementation instead. Flag for agent retraining on age-appropriate products.
            </div>
          </div>
        </div>
      </div>

      <!-- Proposal 3 -->
      <div class="proposal-card high-risk">
        <div class="risk-indicator high">
          <span>⚠️</span>
        </div>

        <div class="proposal-info">
          <div class="info-block">
            <h4>Client & Agent</h4>
            <p>Kumar Rajesh (42)</p>
            <div class="small-text">Agent: Mary Lim</div>
          </div>
          <div class="info-block">
            <h4>Product</h4>
            <p>Whole Life</p>
            <div class="small-text">$1,200/month premium</div>
          </div>
          <div class="info-block">
            <h4>Compliance Score</h4>
            <p style="color: #EF4444;">61/100</p>
            <div class="small-text">4 warnings</div>
          </div>
          <div class="info-block">
            <h4>Submitted</h4>
            <p>6 hours ago</p>
            <div class="small-text">15-Dec-2025</div>
          </div>
        </div>

        <div class="proposal-actions">
          <button class="btn btn-primary" onclick="reviewProposal(3)">Review Details</button>
          <button class="btn btn-ghost">Request Revision</button>
        </div>

        <div style="grid-column: 1 / -1;">
          <div class="ai-recommendation">
            <strong>🤖 AI Recommendation: REQUEST REVISION</strong> (68% confidence)
            <ul class="issues-list">
              <li>⚠️ Premium $1,200/month = 20% of $6,000 income (exceeds 15% by significant margin)</li>
              <li>⚠️ Client supports 3 children + 2 elderly parents (sandwich generation risk)</li>
              <li>⚠️ No mention of spouse income or shared financial responsibilities</li>
              <li>⚠️ Justification lacks detail on affordability stress testing</li>
            </ul>
            <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--info-border);">
              <strong>Suggested Action:</strong> Request additional information: spouse income, total household expenses, and detailed budget breakdown. Consider term life ($500/month) as alternative.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section Divider -->
    <div class="section-divider">
      <span>MEDIUM RISK PROPOSALS</span>
    </div>

    <!-- Medium Risk Proposals (Sample) -->
    <div class="proposal-list">
      <div class="proposal-card medium-risk">
        <div class="risk-indicator medium">
          <span>⚠</span>
        </div>

        <div class="proposal-info">
          <div class="info-block">
            <h4>Client & Agent</h4>
            <p>Chen Wei Ling (29)</p>
            <div class="small-text">Agent: Mahadevan Kartik</div>
          </div>
          <div class="info-block">
            <h4>Product</h4>
            <p>Term Life + CI</p>
            <div class="small-text">$550/month premium</div>
          </div>
          <div class="info-block">
            <h4>Compliance Score</h4>
            <p style="color: #F59E0B;">78/100</p>
            <div class="small-text">2 minor issues</div>
          </div>
          <div class="info-block">
            <h4>Submitted</h4>
            <p>1 day ago</p>
            <div class="small-text">14-Dec-2025</div>
          </div>
        </div>

        <div class="proposal-actions">
          <button class="btn btn-primary" onclick="reviewProposal(4)">Review Details</button>
          <button class="btn btn-secondary">Approve</button>
        </div>

        <div style="grid-column: 1 / -1;">
          <div class="ai-recommendation">
            <strong>🤖 AI Recommendation: APPROVE with CONDITIONS</strong> (72% confidence)
            <ul class="issues-list">
              <li>✓ Premium within 15% guideline (13.75% of income)</li>
              <li>⚠️ Justification could be more detailed on risk appetite assessment</li>
              <li>⚠️ Emergency fund at minimum threshold (exactly 3 months)</li>
            </ul>
          </div>
        </div>
      </div>

      <div style="text-align: center; padding: var(--space-xl); color: var(--gray-500);">
        <p>+ 11 more medium risk proposals</p>
        <button class="btn btn-ghost">View All Medium Risk</button>
      </div>
    </div>

    <!-- Section Divider -->
    <div class="section-divider">
      <span>LOW RISK PROPOSALS (READY FOR BULK APPROVAL)</span>
    </div>

    <!-- Low Risk Summary -->
    <div class="card">
      <div style="padding: var(--space-xl); text-align: center;">
        <div style="font-size: 48px; margin-bottom: var(--space-md);">✅</div>
        <h3 style="margin-bottom: var(--space-sm);">35 Low-Risk Proposals Ready</h3>
        <p style="color: var(--gray-600); margin-bottom: var(--space-lg);">All proposals have passed AI compliance checks with scores above 90/100. MoneySense guidelines met, documentation complete, no red flags detected.</p>
        <div style="display: flex; gap: var(--space-sm); justify-content: center;">
          <button class="btn btn-primary" onclick="bulkApprove()">Approve All 35 Proposals</button>
          <button class="btn btn-ghost">Review Individual Cases</button>
        </div>
      </div>
    </div>

    <!-- Bulk Actions Bar -->
    <div class="bulk-actions">
      <div>
        <span class="text-sm text-gray">Selected: <strong>0 proposals</strong></span>
      </div>
      <div style="display: flex; gap: var(--space-sm);">
        <button class="btn btn-ghost">Select All High Risk</button>
        <button class="btn btn-ghost">Batch Request Revisions</button>
        <button class="btn btn-success" disabled>Approve Selected</button>
      </div>
    </div>
  </div>

  <!-- Review Modal -->
  <div class="review-modal" id="reviewModal">
    <div class="review-modal-content">
      <div class="review-modal-header">
        <div style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-xs);">
              <span class="badge">Opening Full Proposal Review</span>
            </div>
            <h2 style="margin: 0; font-size: 24px;">Proposal ID: <span id="modalProposalId">FHR-2025-0001</span></h2>
          </div>
          <button class="close-modal-btn" onclick="closeReviewModal()">×</button>
        </div>
        <div style="margin-top: var(--space-md); padding: var(--space-md); background: var(--info-bg); border-radius: var(--radius-md); font-size: var(--font-size-sm); color: var(--gray-700);">
          [This would open a detailed review panel showing:
          <ul style="margin: var(--space-xs) 0 0 20px; padding: 0;">
            <li>Complete client profile & FHR form</li>
            <li>All compliance checks with explanations</li>
            <li>AI reasoning and evidence</li>
            <li>Side-by-side comparison with similar approved cases</li>
            <li>Revision history and agent notes</li>
          </ul>
        </div>
      </div>

      <div class="review-modal-body" id="modalBodyContent">
        <!-- Content will be populated by JS -->
      </div>

      <div class="review-modal-footer">
        <button class="btn btn-ghost" onclick="closeReviewModal()">Close</button>
        <div style="display: flex; gap: var(--space-sm);">
          <button class="btn btn-error" onclick="rejectProposal()">❌ Reject</button>
          <button class="btn btn-secondary" onclick="requestRevision()">📝 Request Revision</button>
          <button class="btn btn-success" onclick="approveProposal()">✅ Approve</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Chat Widget -->
  <div class="chat-widget">
    <button class="chat-widget-button" onclick="window.location.href='copilot.html'" title="Ask AI Copilot">
      💬
    </button>
    <div class="chat-widget-tooltip">Ask AI Copilot</div>
  </div>

  <script>
    // Proposal data
    const proposals = {
      1: {
        id: 'FHR-2025-0001',
        client: {
          name: 'Tan Wei Ming',
          nric: 'S8912345A',
          age: 35,
          monthlyIncome: 4500,
          monthlyExpenses: 3200,
          emergencyFund: 8000,
          retirementSavings: 360,
          hasChildren: true,
          numChildren: 2
        },
        product: {
          type: 'Term Life',
          monthlyPremium: 800,
          deathCoverage: 450000,
          ciCoverage: 150000,
          policyTerm: 20
        },
        agent: 'Mahadevan Kartik',
        justification: 'Client has expressed need for family protection with 2 young children (ages 3 and 5). Current income of $4,500/month supports proposed premium. Client has moderate risk appetite and prioritizes protection over investment growth at this life stage.',
        complianceScore: 67,
        submittedDate: '15-Dec-2025 10:30 AM',
        checks: [
          {
            type: 'fail',
            title: 'Premium Ratio Exceeded',
            explanation: 'Premium $800/month = 17.8% of income. MoneySense guideline: maximum 15% ($675/month). Exceeds limit by $125 (2.8%).',
            calculation: '$800 ÷ $4,500 = 17.8%'
          },
          {
            type: 'fail',
            title: 'Insufficient Emergency Fund',
            explanation: 'Emergency fund $8,000 = 2.5 months of expenses. MoneySense guideline: minimum 3-6 months. Shortfall: $1,600 (0.5 months).',
            calculation: '$8,000 ÷ $3,200 = 2.5 months'
          },
          {
            type: 'warning',
            title: 'CI Coverage Below Guideline',
            explanation: 'CI coverage $150,000 = 2.8x annual income. MoneySense guideline: 4x annual income ($216,000). Gap: $66,000.',
            calculation: '$150,000 ÷ $54,000 = 2.8x'
          },
          {
            type: 'pass',
            title: 'Death Coverage Adequate',
            explanation: 'Death coverage $450,000 = 8.3x annual income. Meets MoneySense guideline of 9x (close to target).',
            calculation: '$450,000 ÷ $54,000 = 8.3x'
          },
          {
            type: 'pass',
            title: 'Product Suitable for Life Stage',
            explanation: 'Term Life appropriate for client age 35 with young family. Aligns with "Starting Family" life stage guidelines.',
            calculation: 'N/A'
          },
          {
            type: 'warning',
            title: 'Retirement Savings Low',
            explanation: 'Retirement savings $360/month = 8% of income. MoneySense guideline: minimum 10% ($450/month). Shortfall: $90/month.',
            calculation: '$360 ÷ $4,500 = 8%'
          }
        ]
      },
      2: {
        id: 'FHR-2025-0002',
        client: {
          name: 'Lim Siew Hong',
          nric: 'S5678901B',
          age: 68,
          monthlyIncome: 2500,
          monthlyExpenses: 1800,
          emergencyFund: 15000,
          retirementSavings: 0,
          hasChildren: false,
          numChildren: 0
        },
        product: {
          type: 'Investment-Linked Policy',
          monthlyPremium: 600,
          deathCoverage: 80000,
          ciCoverage: 0,
          policyTerm: 10
        },
        agent: 'John Tan',
        justification: 'Client wants investment growth potential for retirement supplementation. Client acknowledges investment risk.',
        complianceScore: 52,
        submittedDate: '15-Dec-2025 08:15 AM',
        checks: [
          {
            type: 'fail',
            title: 'ILP Unsuitable for Age',
            explanation: 'ILP not recommended for age 65+. MoneySense: seniors should avoid high-risk products. Client age 68 exceeds threshold by 3 years.',
            calculation: 'Age: 68 (threshold: 65)'
          },
          {
            type: 'fail',
            title: 'High Premium Ratio for Retiree',
            explanation: 'Premium $600/month = 24% of income. For retirees on fixed income, recommended max is 10%. Exceeds by 14%.',
            calculation: '$600 ÷ $2,500 = 24%'
          },
          {
            type: 'warning',
            title: 'Missing Risk Disclosure',
            explanation: 'Justification lacks explicit acknowledgment of capital loss risk and investment volatility unsuitable for seniors.',
            calculation: 'N/A'
          },
          {
            type: 'pass',
            title: 'Emergency Fund Adequate',
            explanation: 'Emergency fund $15,000 = 8.3 months of expenses. Exceeds 6-month guideline.',
            calculation: '$15,000 ÷ $1,800 = 8.3 months'
          }
        ]
      },
      3: {
        id: 'FHR-2025-0003',
        client: {
          name: 'Kumar Rajesh',
          nric: 'S7890123C',
          age: 42,
          monthlyIncome: 6000,
          monthlyExpenses: 4200,
          emergencyFund: 18000,
          retirementSavings: 720,
          hasChildren: true,
          numChildren: 3
        },
        product: {
          type: 'Whole Life',
          monthlyPremium: 1200,
          deathCoverage: 500000,
          ciCoverage: 200000,
          policyTerm: 99
        },
        agent: 'Mary Lim',
        justification: 'Client supports 3 children and 2 elderly parents. Needs comprehensive lifetime coverage for sandwich generation responsibilities.',
        complianceScore: 61,
        submittedDate: '15-Dec-2025 06:45 AM',
        checks: [
          {
            type: 'fail',
            title: 'Premium Ratio Too High',
            explanation: 'Premium $1,200/month = 20% of income. Exceeds 15% guideline by 5%. For sandwich generation, should be conservative.',
            calculation: '$1,200 ÷ $6,000 = 20%'
          },
          {
            type: 'warning',
            title: 'Sandwich Generation Risk',
            explanation: 'Client supports 3 children + 2 elderly parents. High financial stress. Justification should address household budget strain.',
            calculation: 'N/A'
          },
          {
            type: 'warning',
            title: 'Missing Spouse Income Info',
            explanation: 'No mention of spouse income or shared financial responsibilities. Critical for affordability assessment.',
            calculation: 'N/A'
          },
          {
            type: 'warning',
            title: 'Affordability Stress Testing Missing',
            explanation: 'Justification lacks detail on how client would maintain premiums if income drops or unexpected expenses arise.',
            calculation: 'N/A'
          },
          {
            type: 'pass',
            title: 'Emergency Fund Strong',
            explanation: 'Emergency fund $18,000 = 4.3 months of expenses. Within 3-6 month guideline.',
            calculation: '$18,000 ÷ $4,200 = 4.3 months'
          },
          {
            type: 'pass',
            title: 'Coverage Adequate',
            explanation: 'Death coverage $500,000 = 6.9x annual income. CI coverage $200,000 = 2.8x. Both meet minimum thresholds.',
            calculation: 'Death: 6.9x, CI: 2.8x'
          }
        ]
      }
    };

    function reviewProposal(id) {
      const proposal = proposals[id];
      if (!proposal) {
        alert('Proposal not found');
        return;
      }

      // Set proposal ID
      document.getElementById('modalProposalId').textContent = proposal.id;

      // Build modal body content
      let html = '';

      // Client Profile Section
      html += `
        <div class="fhr-section">
          <h3>👤 Client Profile</h3>
          <div class="fhr-grid">
            <div class="fhr-field">
              <div class="fhr-label">Client Name</div>
              <div class="fhr-value">${proposal.client.name}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">NRIC</div>
              <div class="fhr-value">${proposal.client.nric}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Age</div>
              <div class="fhr-value">${proposal.client.age} years</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Monthly Income</div>
              <div class="fhr-value">$${proposal.client.monthlyIncome.toLocaleString()}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Monthly Expenses</div>
              <div class="fhr-value">$${proposal.client.monthlyExpenses.toLocaleString()}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Emergency Fund</div>
              <div class="fhr-value">$${proposal.client.emergencyFund.toLocaleString()}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Retirement Savings</div>
              <div class="fhr-value">$${proposal.client.retirementSavings}/month</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Dependents</div>
              <div class="fhr-value">${proposal.client.hasChildren ? proposal.client.numChildren + ' children' : 'None'}</div>
            </div>
          </div>
        </div>
      `;

      // Product Details Section
      html += `
        <div class="fhr-section">
          <h3>📋 Proposed Product</h3>
          <div class="fhr-grid">
            <div class="fhr-field">
              <div class="fhr-label">Product Type</div>
              <div class="fhr-value">${proposal.product.type}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Monthly Premium</div>
              <div class="fhr-value" style="color: var(--aia-red); font-size: 18px;">$${proposal.product.monthlyPremium}/month</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Death/TPD Coverage</div>
              <div class="fhr-value">$${proposal.product.deathCoverage.toLocaleString()}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">CI Coverage</div>
              <div class="fhr-value">${proposal.product.ciCoverage > 0 ? '$' + proposal.product.ciCoverage.toLocaleString() : 'Not included'}</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Policy Term</div>
              <div class="fhr-value">${proposal.product.policyTerm} years</div>
            </div>
            <div class="fhr-field">
              <div class="fhr-label">Agent</div>
              <div class="fhr-value">${proposal.agent}</div>
            </div>
          </div>
        </div>
      `;

      // Justification Section
      html += `
        <div class="fhr-section">
          <h3>📝 Advisory Justification</h3>
          <div style="background: white; padding: var(--space-md); border-radius: var(--radius-sm); line-height: 1.6; font-size: var(--font-size-sm); color: var(--gray-700);">
            ${proposal.justification}
          </div>
        </div>
      `;

      // Compliance Checks Section
      html += `
        <div style="margin-bottom: var(--space-lg);">
          <h3 style="font-size: 18px; font-weight: 700; margin-bottom: var(--space-md); color: var(--gray-900);">
            ✅ Compliance Checks (${proposal.checks.filter(c => c.type === 'fail').length} Failed,
            ${proposal.checks.filter(c => c.type === 'warning').length} Warnings,
            ${proposal.checks.filter(c => c.type === 'pass').length} Passed)
          </h3>
      `;

      proposal.checks.forEach(check => {
        const icon = check.type === 'pass' ? '✓' : check.type === 'warning' ? '⚠️' : '❌';
        html += `
          <div class="compliance-check-item ${check.type}">
            <div class="check-title">
              <span>${icon}</span>
              <span>${check.title}</span>
            </div>
            <div class="check-explanation">
              ${check.explanation}
              ${check.calculation !== 'N/A' ? '<br/><strong>Calculation:</strong> ' + check.calculation : ''}
            </div>
          </div>
        `;
      });

      html += '</div>';

      // Submission Info
      html += `
        <div style="padding: var(--space-md); background: var(--gray-50); border-radius: var(--radius-md); font-size: var(--font-size-sm); color: var(--gray-600);">
          <strong>Submitted:</strong> ${proposal.submittedDate} • <strong>Agent:</strong> ${proposal.agent} • <strong>Compliance Score:</strong> ${proposal.complianceScore}/100
        </div>
      `;

      document.getElementById('modalBodyContent').innerHTML = html;
      document.getElementById('reviewModal').classList.add('active');
    }

    function closeReviewModal() {
      document.getElementById('reviewModal').classList.remove('active');
    }

    function approveProposal() {
      if (confirm('✅ Approve this proposal?\n\nThis will:\n• Send approval notification to agent\n• Update client record\n• Generate approval certificate\n• Log audit trail\n\nProceed?')) {
        alert('✅ Proposal Approved!\n\nNotification sent to agent.\nClient record updated.\nAudit trail logged.');
        closeReviewModal();
      }
    }

    function rejectProposal() {
      const reason = prompt('❌ Reject Proposal\n\nPlease provide rejection reason:');
      if (reason) {
        alert('❌ Proposal Rejected\n\nReason: ' + reason + '\n\nAgent will be notified to revise or withdraw.');
        closeReviewModal();
      }
    }

    function requestRevision() {
      const feedback = prompt('📝 Request Revision\n\nProvide specific feedback for agent:');
      if (feedback) {
        alert('📝 Revision Requested\n\nFeedback: ' + feedback + '\n\nAgent will be notified to update and resubmit.');
        closeReviewModal();
      }
    }

    function bulkApprove() {
      if (confirm('⚡ Bulk Approve 35 Low-Risk Proposals?\n\nAll proposals have:\n✓ Compliance scores 90-98/100\n✓ MoneySense guidelines met\n✓ Complete documentation\n✓ AI confidence >85%\n\nThis action will:\n• Send approval notifications to 35 agents\n• Update client records\n• Generate approval certificates\n• Log audit trail\n\nProceed with bulk approval?')) {
        alert('✅ Success!\n\n35 proposals approved in 2.3 seconds.\n\nNotifications sent to agents.\nAudit trail logged.\nAverage manual review time saved: 8.75 hours.');
      }
    }

    // Close modal on background click
    document.getElementById('reviewModal').addEventListener('click', (e) => {
      if (e.target.id === 'reviewModal') {
        closeReviewModal();
      }
    });
  </script>
</body>
</html>
